#!/bin/bash
# Pre-commit hook to update the version in pyproject.toml based on the latest git tag

# If you want to set up this pre-commit hook, follow these steps:
# Run from the root of the repository
# 1. Ensure the script is executable:
# chmod +x devtools/hooks/pre-commit
# 2. Add a symlink in .git/hooks pointing to the script:
# ln -sf ../../devtools/hooks/pre-commit .git/hooks/pre-commit

# Get the latest tag (assumes tags are valid version numbers)
TAG=$(git describe --tags --abbrev=0 2>/dev/null)

if [[ -z "$TAG" ]]; then
  echo "No git tag found. Skipping version update in pyproject.toml."
  exit 0
fi

# Update the version in pyproject.toml
if grep -q '^version = ' pyproject.toml; then
  # Replace the version line
  sed -i "s/^version = \".*\"/version = \"$TAG\"/" pyproject.toml
else
  # Add version line if not present
  echo "version = \"$TAG\"" >> pyproject.toml
fi

# Add pyproject.toml to the commit if it was changed
git add pyproject.toml

exit 0